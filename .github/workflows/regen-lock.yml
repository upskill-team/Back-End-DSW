name: Fix lockfile conflicts

on:
  pull_request:
    types: [synchronize, opened, reopened]

jobs:
  fix-lock:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # necesario para poder hacer commits

      - name: Setup Node + pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9.12.0

      - name: Install dependencies
        run: pnpm install --frozen-lockfile=false

      - name: Check for lockfile changes
        run: |
          if ! git diff --quiet pnpm-lock.yaml; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add pnpm-lock.yaml
            git commit -m "chore: regenerate pnpm-lock.yaml to fix conflict"
            git push
          fi
