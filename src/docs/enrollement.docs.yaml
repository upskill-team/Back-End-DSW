tags:
  - name: Enrollements
    description: Operations to manage student enrollements in courses.

components:
  schemas:
    Enrollement:
      type: object
      properties:
        id:
          type: string
          description: Auto-generated enrollement ID.
          example: '507f1f77bcf86cd799439011'
        course:
          type: string
          description: ID of the course.
          example: '507f1f77bcf86cd799439012'
        student:
          type: string
          description: ID of the student.
          example: '507f191e810c19729de860ea'
        enrolledAt:
          type: string
          format: date-time
          description: Date when the student enrolled.
        state:
          type: string
          enum: ['enrolled', 'completed', 'dropped']
          description: Current enrollment state.
          example: 'enrolled'
        grade:
          type: number
          nullable: true
          description: Grade/score obtained (optional).
          example: 85.5
        progress:
          type: number
          description: Progress percentage (0-100).
          example: 75
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateEnrollementInput:
      type: object
      required:
        - studentId
        - courseId
      properties:
        studentId:
          type: string
          description: ID of the student to enroll.
          example: '507f191e810c19729de860ea'
        courseId:
          type: string
          description: ID of the course to enroll into.
          example: '507f1f77bcf86cd799439012'
        state:
          type: string
          enum: ['enrolled', 'completed', 'dropped']
          description: Initial state (defaults to "enrolled").
          example: 'enrolled'
        grade:
          type: number
          description: Initial grade (optional).
          example: 90
        progress:
          type: number
          description: Initial progress percentage (0-100).
          example: 0
        enrolledAt:
          type: string
          format: date-time
          description: Enrollment date (optional). Defaults to now.

    UpdateEnrollementInput:
      type: object
      properties:
        state:
          type: string
          enum: ['enrolled', 'completed', 'dropped']
        grade:
          type: number
        progress:
          type: number
        enrolledAt:
          type: string
          format: date-time

    EnrollementList:
      type: array
      items:
        $ref: '#/components/schemas/Enrollement'

paths:
  /enrollements:
    get:
      summary: List / search enrollements
      tags: [Enrollements]
      description: Returns a paginated list of enrollements. Accepts query filters.
      parameters:
        - name: studentId
          in: query
          schema:
            type: string
          description: Filter by student ID.
        - name: courseId
          in: query
          schema:
            type: string
          description: Filter by course ID.
        - name: state
          in: query
          schema:
            type: string
            enum: ['enrolled', 'completed', 'dropped']
          description: Filter by enrollment state.
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: sortBy
          in: query
          schema:
            type: string
            default: createdAt
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: ['ASC', 'DESC']
            default: DESC
      responses:
        '200':
          description: List of enrollements.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollementList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      summary: Create an enrollement
      tags: [Enrollements]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnrollementInput'
      responses:
        '201':
          description: Enrollement created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Enrollement'
        '400':
          description: Validation error or business rule (e.g. already enrolled).
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /enrollements/{id}:
    get:
      summary: Get enrollement by ID
      tags: [Enrollements]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Enrollement found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Enrollement'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      summary: Partially update an enrollement
      tags: [Enrollements]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEnrollementInput'
      responses:
        '200':
          description: Enrollement updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Enrollement'
        '400':
          description: Validation error.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      summary: Delete an enrollement
      tags: [Enrollements]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Enrollement deleted.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /enrollements/student/{studentId}:
    get:
      summary: Get enrollements by student
      tags: [Enrollements]
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of enrollements for the student.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollementList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /enrollements/course/{courseId}:
    get:
      summary: Get enrollements by course
      tags: [Enrollements]
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of enrollements for the course.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollementList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
